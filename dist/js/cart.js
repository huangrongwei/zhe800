"use strict";$(function(){var e=Cookie.get("name");function n(t,e,n){t&&$(".diglog article").html(t),$(".shadow").css("display","block"),$(".diglog").css("display","block"),$(".diglog .submit input:eq(0)").click(function(){e()}),$(".diglog .submit input:eq(1)").click(function(){n()}),$(".diglog h4 span").click(function(){n()})}function a(t){var e=t.find(".number input").val(),n=$.trim(t.find(".price p:eq(0)").html());t.find(".money").html((e*n).toFixed(0))}function t(){r?($("#List .bottom").css({border:"1px solid red",background:"#fdf4f6"}),$("#resbtn").css({background:"red",color:"#fff"}),$(".list .result label input").prop("checked","checked"),$(".list .result").css("border","1px solid red"),$(".item_head label").css("background","url(../img/check.png) no-repeat 0px -27px"),$(".item_head label input").prop("checked","checked"),$(".result label").css("background","url(../img/check.png) no-repeat 0px -27px"),$("#List .bottom label input").prop("checked","checked"),$("#List .bottom label").css("background","url(../img/check.png) no-repeat 0px -27px")):($("#List .bottom").css({border:"1px solid #e5e5e5",background:"#e9e9e9"}),$("#resbtn").css({background:"#e5e5e5",color:"#666"}),$(".list .result label input").removeAttr("checked"),$(".list .result").css("border","1px solid #e5e5e5"),$("#List .bottom").css("border","1px solid #e5e5e5"),$(".item_head label").css("background","url(../img/check.png) no-repeat 0px -14px"),$(".item_head label input").removeAttr("checked"),$(".result label").css("background","url(../img/check.png) no-repeat 0px -14px"),$("#List .bottom label input").removeAttr("checked"),$("#List .bottom label").css("background","url(../img/check.png) no-repeat 0px -14px")),r=!r}$(".toolbar .nav").on("click","li",function(){if("退出"==$(this).find("a b").text()){var t=new Date;t.setDate(t.getDate()-7),Cookie.set("name",e,{expires:t,path:"/"}),location.href="../index1.html"}}),e?($(".toolbar .nav .qq").remove(),$(".toolbar .nav li").eq(2).html('<a href="javascript:;"><span style="color:red;margin-right:5px;">您好,'+e+"</span><b>退出</b></a>"),$.ajax({type:"POST",url:"../api/query.php",async:!0,data:{method:"alllist",listname:"goodslist"},success:function(t){var e=JSON.parse(t),n=JSON.parse(e.content);$(".num1").text(n.length)}})):$(".num1").text(0);var c=[];function l(){c.length=0;for(var t=$("#List .bottom label input").size(),e=0;e<t;e++)$("#List .bottom label input").eq(e).prop("checked")&&c.push(e);var n=0,i=0;for(e=0;e<c.length;e++){n+=1*$("#List .number input").eq(c[e]).val();var s=$("#List .bottom .money").eq(c[e]).text();s=$.trim(s),i+=s*=1}$(".result .mm i").html(n),$(".result .amount span").html("￥ "+i.toFixed(0))}function i(){0==$("#List li").size()&&($(".list .item").css("display","none"),$(".list .empty").css("display","block"))}$.ajax({type:"POST",url:"../api/query.php",async:!0,data:{method:"alllist",listname:"goodslist"},success:function(t){var e=JSON.parse(t),n=JSON.parse(e.content);$("#List").html(n.map(function(t){return'<li data-id="'+t.id+'">\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t<div class="bottom">\n\t\t\t\t\t\t\t\t<label>\n\t\t\t\t\t\t\t\t\t<input type="checkbox" name="" >\n\t\t\t\t\t\t\t\t</label>\n\t\t\t\t\t\t\t\t<div class="yifu">\n\t\t\t\t\t\t\t\t\t<img src="../'+t.url+'" alt="">\n\t\t\t\t\t\t\t\t\t<h3><a href="javascript:;" title="">'+t.name+'</a></h3>\n\t\t\t\t\t\t\t\t\t<div class="type">\n\t\t\t\t\t\t\t\t\t\t颜色: 杏色 <br>\n\t\t\t\t\t\t\t\t\t\t尺码: XL\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="price">\n\t\t\t\t\t\t\t\t\t<p class="price1">'+t.xianjia+"</p>\n\t\t\t\t\t\t\t\t\t<p><del>"+t.yuan+'</del></p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="number">\n\t\t\t\t\t\t\t\t\t<i>-</i>\n\t\t\t\t\t\t\t\t\t<input type="text" value="'+t.num+'">\n\t\t\t\t\t\t\t\t\t<i>+</i>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="money">\n\t\t\t\t\t\t\t\t\t'+t.price+'\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class="move">\n\t\t\t\t\t\t\t\t\t<a href="javascript:;" id="delete">删除</a> <br>\n\t\t\t\t\t\t\t\t\t<a href="javascript:;">移入收藏</a>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</li>'}).join("")),i()}}),$(window).scroll(function(){var t=$(this).scrollTop();200<=t?$("#topback").css("display","block"):t<200&&$("#topback").css("display","none")}),$("#topback").click(function(){window.scrollTo(0,0)});var s=!0;$("#all input").click(function(){s?($(this).prev("checked","checked"),$("#all").css("background-position","0px -27px")):($(this).removeAttr("checked"),$("#all").css("background-position","0px -14px")),s=!s});var o=Cookie.get("username");o&&($(".toolbar .nav .qq").remove(),$(".toolbar .nav li").eq(2).html('<a href="javascript:;"><span style="color:red;margin-right:5px;">您好,'+o+"</span><b>退出</b></a>")),$(".toolbar .nav").on("click","li",function(){if("退出"==$(this).find("a b").text()){n("确定要退出吗？",function(){$(".shadow").css("display","none"),$(".diglog").css("display","none"),Cookie.remove("username","/src"),location.href="result.html"},function(){$(".shadow").css("display","none"),$(".diglog").css("display","none")})}});$("#List").on("click","#delete",function(){var t=$(this).parent().parent().parent().attr("data-id"),e=$(this).parent().parent().parent();n("确定删除该商品吗？",function(){e.remove(),$(".shadow").css("display","none"),$(".diglog").css("display","none"),$.ajax({type:"POST",url:"../api/delete.php",async:!0,data:{method:"delete",listname:"goodslist",id:t},success:function(t){l(),i()}})},function(){$(".shadow").css("display","none"),$(".diglog").css("display","none")})}),$("#List").on("click",".bottom .number i",function(){var t=Number($(this).parent().find("input").val()),e=$(this).parent().prev().children(".price1").text();console.log(e);var n=$(this).parent().parent().parent().attr("data-id"),i=$(this).parent().parent();"-"==$(this).html()&&((s=e*(t-1))<=e&&(s=e),t<=1||t--,$(this).parent().find("input").val(t),a(i),$.ajax({type:"GET",url:"../api/cart.php",async:!0,data:{id:n,num:t,price:s},success:function(t){}}));if("+"==$(this).html()){var s=e*(t+1);console.log(s),console.log(t+1),10<=t||t++,$(this).parent().find("input").val(t),a(i),$.ajax({type:"GET",url:"../api/cart.php",async:!0,data:{id:n,num:t,price:s},success:function(t){console.log(t)}})}l()});var r=!0;$(".result label input").on("click",function(){t(),l()}),$(".item_head label input").on("click",function(){t(),l()}),$(".result span a:eq(0)").click(function(){t(),l()});var p="";$(".result span a:eq(1)").on("click",function(){l();n("您确定要删除全部商品吗？",function(){for(var t=c.length-1;0<=t;t--)p+=$("#List li").eq(c[t]).attr("data-id")+",",$("#List li").eq(c[t]).remove();$(".shadow").css("display","none"),$(".diglog").css("display","none"),$.ajax({type:"POST",url:"../api/delete.php",async:!0,data:{method:"alldelete",listname:"goodslist",cid:p.slice(0,-1)},success:function(t){"1"==t&&(l(),i()),console.log(t)}})},function(){$(".shadow").css("display","none"),$(".diglog").css("display","none")})}),$("#List").on("click",".bottom label input",function(){l(),$(this).prop("checked")?($(this).parent().css("background","url(../img/check.png) no-repeat 0px -27px"),$(this).parent().parent().css({border:"1px solid red",background:"#fdf4f6"}),$("#resbtn").css({background:"red",color:"#fff"}),$(".item .result").css("border","1px solid red")):($(this).parent().css("background","url(../img/check.png) no-repeat 0px -14px"),$(this).parent().parent().css({border:"1px solid #e5e5e5",background:"#e9e9e9"})),r=c.length==$("#List li").size()?($(".result label input").prop("checked","checked"),$(".result label").css("background","url(../img/check.png) no-repeat 0px -27px"),$(".list .item .item_head label input").prop("checked","checked"),$(".list .item .item_head label").css("background","url(../img/check.png) no-repeat 0px -27px"),!1):($(".result label input").removeAttr("checked"),$(".result label").css("background","url(../img/check.png) no-repeat 0px -14px"),$(".list .item .item_head label input").removeAttr("checked"),$(".list .item .item_head label").css("background","url(../img/check.png) no-repeat 0px -14px"),!0),0==c.length&&($("#resbtn").css({background:"#e5e5e5",color:"#666"}),$(".list .result").css("border","1px solid #e5e5e5"))})});